CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `recommendations_get_all` AS select `data`.`recommendation_id` AS `recommendation_id`,`data`.`type` AS `type`,`data`.`requirement_a_id` AS `requirement_a_id`,`data`.`project_a_id` AS `project_a_id`,`data`.`project_a_name` AS `project_a_name`,`data`.`proj_a_percentage_completed` AS `proj_a_percentage_completed`,`data`.`requirement_a_description` AS `requirement_a_description`,`data`.`requirement_b_id` AS `requirement_b_id`,`data`.`project_b_id` AS `project_b_id`,`data`.`project_b_name` AS `project_b_name`,`data`.`proj_b_percentage_completed` AS `proj_b_percentage_completed`,`data`.`Requirement_b_description` AS `Requirement_b_description`,`data`.`distance` AS `distance` from (select `rec`.`recommendation_id` AS `recommendation_id`,`rec`.`type` AS `type`,`req_a`.`requirement_id` AS `requirement_a_id`,`proj_a`.`project_id` AS `project_a_id`,`proj_a`.`name` AS `project_a_name`,cast(((select sum(`t`.`percentage_completed`) from `nhatos`.`tasks` `t` where `t`.`requirement_id` in (select `req_a_aux`.`requirement_id` from `nhatos`.`requirements` `req_a_aux` where (`req_a_aux`.`project_id` = `proj_a`.`project_id`))) / (select count(distinct `nhatos`.`tasks`.`task_id`) from `nhatos`.`tasks` where `nhatos`.`tasks`.`requirement_id` in (select `req_a_aux`.`requirement_id` from `nhatos`.`requirements` `req_a_aux` where (`req_a_aux`.`project_id` = `proj_a`.`project_id`)))) as decimal(10,1)) AS `proj_a_percentage_completed`,substr(`req_a`.`description`,1,150) AS `requirement_a_description`,`req_b`.`requirement_id` AS `requirement_b_id`,`proj_b`.`project_id` AS `project_b_id`,`proj_b`.`name` AS `project_b_name`,cast(((select sum(`t`.`percentage_completed`) from `nhatos`.`tasks` `t` where `t`.`requirement_id` in (select `req_a_aux`.`requirement_id` from `nhatos`.`requirements` `req_a_aux` where (`req_a_aux`.`project_id` = `proj_b`.`project_id`))) / (select count(distinct `nhatos`.`tasks`.`task_id`) from `nhatos`.`tasks` where `nhatos`.`tasks`.`requirement_id` in (select `req_a_aux`.`requirement_id` from `nhatos`.`requirements` `req_a_aux` where (`req_a_aux`.`project_id` = `proj_b`.`project_id`)))) as decimal(10,1)) AS `proj_b_percentage_completed`,substr(`req_b`.`description`,1,150) AS `Requirement_b_description`,cast(`rec`.`distance` as decimal(4,3)) AS `distance` from (((((`nhatos`.`recommendations` `rec` left join `nhatos`.`requirements` `req_a` on((`req_a`.`requirement_id` = `rec`.`requirement_a_id`))) left join `nhatos`.`requirements` `req_b` on((`req_b`.`requirement_id` = `rec`.`requirement_b_id`))) left join `nhatos`.`projects` `proj_a` on((`req_a`.`project_id` = `proj_a`.`project_id`))) left join `nhatos`.`projects` `proj_b` on((`req_b`.`project_id` = `proj_b`.`project_id`))) left join `nhatos`.`requirements_recommendations` `req_rec` on((`req_rec`.`recommendation_id` = `rec`.`recommendation_id`))) where ((1 = 1) and (`rec`.`distance` < 0.9) and (`proj_a`.`size` = `proj_b`.`size`) and (`proj_a`.`methodology` = `proj_b`.`methodology`) and (`proj_a`.`project_id` <> `proj_b`.`project_id`) and isnull(`req_rec`.`requirement_recommendation_id`) and (not(`rec`.`requirement_b_id` in (select `nhatos`.`recommendations`.`requirement_b_id` from `nhatos`.`recommendations` where `nhatos`.`recommendations`.`recommendation_id` in (select `nhatos`.`requirements_recommendations`.`recommendation_id` from `nhatos`.`requirements_recommendations` where (`nhatos`.`requirements_recommendations`.`project_id` = `proj_a`.`project_id`))))))) `data` where (`data`.`proj_a_percentage_completed` between (`data`.`proj_b_percentage_completed` - 5) and (`data`.`proj_b_percentage_completed` + 5));
